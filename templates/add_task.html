{% extends "base.html" %}

{% block title %}Add Task - Task Tracker{% endblock %}

{% block extra_head %}
<style>
    .quick-action-btn {
        margin: 2px;
    }
    .priority-high { border-left: 4px solid #dc3545; }
    .priority-medium { border-left: 4px solid #ffc107; }
    .priority-low { border-left: 4px solid #28a745; }
</style>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        {% if quick_date %}
        document.getElementById('due_date').value = '{{ quick_date }}';
        {% endif %}
    });
</script>
{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10 col-lg-8">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">
                    <i class="bi bi-plus-circle"></i> Add New Task
                </h4>
            </div>
            <div class="card-body">
                <!-- Quick Actions -->
                <div class="mb-3">
                    <label class="form-label">Quick Actions:</label>
                    <div>
                        <button type="button" class="btn btn-sm btn-outline-primary quick-action-btn" onclick="setQuickDate('today')">
                            <i class="bi bi-calendar-day"></i> Today
                        </button>
                        <button type="button" class="btn btn-sm btn-outline-primary quick-action-btn" onclick="setQuickDate('tomorrow')">
                            <i class="bi bi-calendar-plus"></i> Tomorrow
                        </button>
                        <button type="button" class="btn btn-sm btn-outline-primary quick-action-btn" onclick="setQuickDate('week')">
                            <i class="bi bi-calendar-week"></i> This Week
                        </button>
                        <button type="button" class="btn btn-sm btn-outline-primary quick-action-btn" onclick="setQuickDate('month')">
                            <i class="bi bi-calendar-month"></i> This Month
                        </button>
                        <button type="button" class="btn btn-sm btn-outline-secondary quick-action-btn" onclick="clearQuickDate()">
                            <i class="bi bi-x"></i> No Date
                        </button>
                    </div>
                </div>

                <form method="POST" action="{{ url_for('add_task') }}" id="addTaskForm">
                    <div class="mb-3">
                        <label for="title" class="form-label">
                            Task Title <span class="text-danger">*</span>
                        </label>
                        <input type="text" 
                               class="form-control" 
                               id="title" 
                               name="title" 
                               required 
                               maxlength="200"
                               placeholder="Enter task title">
                        <div class="form-text">Maximum 200 characters</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="description" class="form-label">Description</label>
                        <textarea class="form-control" 
                                  id="description" 
                                  name="description" 
                                  rows="5"
                                  maxlength="1000"
                                  placeholder="Enter task description (optional)"></textarea>
                        <div class="form-text">Maximum 1000 characters</div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="due_date" class="form-label">
                                <i class="bi bi-calendar"></i> Due Date
                            </label>
                            <input type="date" 
                                   class="form-control" 
                                   id="due_date" 
                                   name="due_date">
                            <div class="form-text">Select a due date for this task</div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label for="priority" class="form-label">
                                <i class="bi bi-flag"></i> Priority
                            </label>
                            <select class="form-select" id="priority" name="priority">
                                <option value="low">ðŸŸ¢ Low</option>
                                <option value="medium" selected>ðŸŸ¡ Medium</option>
                                <option value="high">ðŸ”´ High</option>
                            </select>
                            <div class="form-text">Set task priority level</div>
                        </div>
                    </div>

                    <!-- Recurring Task Options -->
                    <div class="card mb-3">
                        <div class="card-header bg-light">
                            <div class="form-check">
                                <input class="form-check-input" 
                                       type="checkbox" 
                                       id="is_recurring" 
                                       name="is_recurring"
                                       onchange="toggleRecurringOptions()">
                                <label class="form-check-label" for="is_recurring">
                                    <i class="bi bi-arrow-repeat"></i> Make this a recurring task
                                </label>
                            </div>
                        </div>
                        <div class="card-body" id="recurringOptions" style="display: none;">
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="recurring_type" class="form-label">Repeat</label>
                                    <select class="form-select" id="recurring_type" name="recurring_type">
                                        <option value="">Select...</option>
                                        <option value="daily">Daily</option>
                                        <option value="weekly">Weekly</option>
                                        <option value="monthly">Monthly</option>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="recurring_time" class="form-label">Time (Optional)</label>
                                    <input type="time" 
                                           class="form-control" 
                                           id="recurring_time" 
                                           name="recurring_time"
                                           placeholder="HH:MM">
                                    <div class="form-text">e.g., 7:00 AM for daily class</div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="recurring_end_date" class="form-label">End Date (Optional)</label>
                                    <input type="date" 
                                           class="form-control" 
                                           id="recurring_end_date" 
                                           name="recurring_end_date">
                                    <div class="form-text">When to stop recurring</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" 
                                   type="checkbox" 
                                   id="is_shared" 
                                   name="is_shared">
                            <label class="form-check-label" for="is_shared">
                                <i class="bi bi-share"></i> Share this task with other users
                            </label>
                        </div>
                        <div class="form-text">When shared, other users can view this task</div>
                    </div>
                    
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <a href="{{ url_for('index') }}" class="btn btn-secondary">
                            <i class="bi bi-x-circle"></i> Cancel
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-circle"></i> Add Task
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    function setQuickDate(type) {
        const dateInput = document.getElementById('due_date');
        const today = new Date();
        let date = new Date();
        
        switch(type) {
            case 'today':
                // Today
                break;
            case 'tomorrow':
                date.setDate(today.getDate() + 1);
                break;
            case 'week':
                // Next 7 days - set to end of week (Sunday)
                const daysUntilSunday = 7 - today.getDay();
                date.setDate(today.getDate() + daysUntilSunday);
                break;
            case 'month':
                // End of current month
                date = new Date(today.getFullYear(), today.getMonth() + 1, 0);
                break;
        }
        
        dateInput.value = date.toISOString().split('T')[0];
    }
    
    function clearQuickDate() {
        document.getElementById('due_date').value = '';
    }
    
    function toggleRecurringOptions() {
        const checkbox = document.getElementById('is_recurring');
        const options = document.getElementById('recurringOptions');
        options.style.display = checkbox.checked ? 'block' : 'none';
        
        if (!checkbox.checked) {
            document.getElementById('recurring_type').value = '';
            document.getElementById('recurring_time').value = '';
            document.getElementById('recurring_end_date').value = '';
        }
    }
</script>
{% endblock %}

